data[data$Y != 0 & data$W != 0]
View(data)
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
X <- italy[,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
Y <- italy[,3]
sum(italy$Y==0)
data <- cbind(X,Y)
data$W
data$Y
data[data$Y != 0 & data$W != 0]
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
X <- italy[,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
Y <- italy[,3]
sum(italy$Y==0)
data <- cbind(X,Y)
data=data[data$Y != 0 & data$W != 0,]
data$Y=log(data$Y)
data$W=log(data$W)
#data=sample_n(data,300)
x = model.matrix(Y~., data=data)
y = data$Y
n = nrow(x) #10876
d = ncol(x) #57
#eliminate ANASC becuase we have age
#eliminate TIPOLAU_2 (scienze agrarie e veterinaria)
#eliminate Q
#eliminate SMARTW_2 which is for people who can not work remote
#eliminate TIPODIP_0 so istituto tecnico or no highschool is the base case
#eliminate SETT_1 so agricolture or no sector is the base case
model <- lm(log(Y)~., data=data)
model <- lm(Y~., data=data)
summary(model)
lasso.bic <- function(y,x,extended=FALSE) {
#Select model in LASSO path with best BIC (using LASSO regression estimates)
#Input
# - y: vector with response variable
# - x: design matrix
#
#Output: list with the following elements
# - coef: LASSO-estimated regression coefficient with lambda set via BIC
# - ypred: predicted y
# - lambda.opt: optimal value of lambda
# - lambda: data.frame with bic and number of selected variables for each value of lambda
require(glmnet)
fit <- glmnet(x=x,y=y,family='gaussian',alpha=1)
pred <- cbind(1,x) %*% rbind(fit$a0,fit$beta)
n <- length(y)
p <- colSums(fit$beta!=0) + 1
if (!extended){
bic <- n * log(colSums((y-pred)^2)/length(y)) + n*(log(2*pi)+1) + log(n)*p
} else {
bic <- n * log(colSums((y-pred)^2)/length(y)) + n*(log(2*pi)+1) + log(n)*p + 2*log(choose(ncol(x),p))
}
sel <- which.min(bic)
beta <- c(fit$a0[sel],fit$beta[,sel]); names(beta)[1]= 'Intercept'
ypred <- pred[,sel]
ans <- list(coef=beta,ypred=ypred,lambda.opt=fit$lambda[sel],lambda=data.frame(lambda=fit$lambda,bic=bic,nvars=p))
return(ans)
}
fit.lassobic = lasso.bic(y,x[,-1])
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
X <- italy[italy$Y != 0 & italy$W != 0,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
Y <- italy[italy$Y != 0 & italy$W != 0,3]
data <- cbind(X,Y)
#data=data[data$Y != 0 & data$W != 0,]
data$Y=log(data$Y)
data$W=log(data$W)
#data=sample_n(data,300)
x = model.matrix(Y~., data=data)
y = data$Y
n = nrow(x) #10876
d = ncol(x) #57
#eliminate ANASC becuase we have age
#eliminate TIPOLAU_2 (scienze agrarie e veterinaria)
#eliminate Q
#eliminate SMARTW_2 which is for people who can not work remote
#eliminate TIPODIP_0 so istituto tecnico or no highschool is the base case
#eliminate SETT_1 so agricolture or no sector is the base case
fit.lassobic = lasso.bic(y,x[,-1])
fit.lassobic = lasso.bic(y,x[,-1])
fit.lassobic = lasso.bic(y,x[,-1])
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
X <- italy[italy$Y != 0 & italy$W != 0,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
Y <- italy[italy$Y != 0 & italy$W != 0,3]
data <- cbind(X,Y)
#data=data[data$Y != 0 & data$W != 0,]
data$Y=log(data$Y)
data$W=log(data$W)
#data=sample_n(data,300)
x = model.matrix(Y~., data=data)
y = data$Y
n = nrow(x) #10876
d = ncol(x) #57
#eliminate ANASC becuase we have age
#eliminate TIPOLAU_2 (scienze agrarie e veterinaria)
#eliminate Q
#eliminate SMARTW_2 which is for people who can not work remote
#eliminate TIPODIP_0 so istituto tecnico or no highschool is the base case
#eliminate SETT_1 so agricolture or no sector is the base case
nrow(x)
nrow(y)
length(y)
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
X <- italy[italy$Y != 0 | italy$W != 0,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
Y <- italy[italy$Y != 0 | italy$W != 0,3]
data <- cbind(X,Y)
#data=data[data$Y != 0 & data$W != 0,]
data$Y=log(data$Y)
data$W=log(data$W)
#data=sample_n(data,300)
x = model.matrix(Y~., data=data)
y = data$Y
n = nrow(x) #10876
d = ncol(x) #57
nrow(x)
length(y)
#eliminate ANASC becuase we have age
#eliminate TIPOLAU_2 (scienze agrarie e veterinaria)
#eliminate Q
#eliminate SMARTW_2 which is for people who can not work remote
#eliminate TIPODIP_0 so istituto tecnico or no highschool is the base case
#eliminate SETT_1 so agricolture or no sector is the base case
italy[italy$Y != 0 | italy$W != 0,3]
nrow(X)
length(Y)
nrow(Y)
nrow(X)
nrow(Y)
X <- italy[italy$Y != 0 & italy$W != 0,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
Y <- italy[italy$Y != 0 & italy$W != 0,3]
nrow(X)
nrow(Y)
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
X <- italy[italy$Y != 0 & italy$W != 0,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
Y <- italy[italy$Y != 0 & italy$W != 0,3]
nrow(X)
nrow(Y)
data <- cbind(X,Y)
#data=data[data$Y != 0 & data$W != 0,]
data$Y=log(data$Y)
data$W=log(data$W)
#data=sample_n(data,300)
x = model.matrix(Y~., data=data)
y = data$Y
n = nrow(x) #10876
d = ncol(x) #57
nrow(x)
length(y)
#eliminate ANASC becuase we have age
#eliminate TIPOLAU_2 (scienze agrarie e veterinaria)
#eliminate Q
#eliminate SMARTW_2 which is for people who can not work remote
#eliminate TIPODIP_0 so istituto tecnico or no highschool is the base case
#eliminate SETT_1 so agricolture or no sector is the base case
View(data)
x
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
PATH = getwd()
library(bayestestR)
library(rstanarm)
library(ggplot2)
library(tidyverse)
library(mombf)
library(hdm)
library(glmnet)
library(HDCI)
library(gridExtra)
library(mvtnorm)
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
italy_final=italy[italy$ETA>15,]
italy_final$W[italy_final$W == 0]=0.1
italy_final=italy_final[italy_final$W>=0,]
italy_final=italy_final[italy_final$Y>0,]
#X <- italy[italy$Y > 0 & italy$W > 0,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
#Y <- italy[italy$Y > 0 & italy$W > 0,3]
X <- italy_final[,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
Y <- italy_final[,3]
data <- cbind(X,Y)
#data=data[data$Y != 0 & data$W != 0,]
data$Y=log(data$Y)
data$W=log(data$W)
which(is.na(x), arr.ind=TRUE)
sum(is.na(x))
#data=sample_n(data,300)
x = model.matrix(Y~., data=data)
y = data$Y
n = nrow(x) #10635
d = ncol(x) #57
nrow(x)
length(y)
#eliminate ANASC becuase we have age
#eliminate TIPOLAU_2 (scienze agrarie e veterinaria)
#eliminate Q
#eliminate SMARTW_2 which is for people who can not work remote
#eliminate TIPODIP_0 so istituto tecnico or no highschool is the base case
#eliminate SETT_1 so agricolture or no sector is the base case
model <- lm(Y~., data=data)
summary(model)
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
italy_final=italy[italy$ETA>15,]
italy_final$W[italy_final$W == 0]=0.1
italy_final=italy_final[italy_final$W>=0,]
italy_final=italy_final[italy_final$Y>0,]
#X <- italy[italy$Y > 0 & italy$W > 0,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
#Y <- italy[italy$Y > 0 & italy$W > 0,3]
X <- italy_final[,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
Y <- italy_final[,3]
data <- cbind(X,Y)
#data=data[data$Y != 0 & data$W != 0,]
data$Y=log(data$Y)
data$W=log(data$W)
which(is.na(x), arr.ind=TRUE)
sum(is.na(x))
#data=sample_n(data,300)
x = model.matrix(Y~., data=data)
y = data$Y
n = nrow(x) #10635
d = ncol(x) #57
nrow(x)
length(y)
#eliminate ANASC becuase we have age
#eliminate TIPOLAU_2 (scienze agrarie e veterinaria)
#eliminate Q
#eliminate SMARTW_2 which is for people who can not work remote
#eliminate TIPODIP_0 so istituto tecnico or no highschool is the base case
#eliminate SETT_1 so agricolture or no sector is the base case
model <- lm(Y~., data=data)
summary(model)
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
italy_final=italy[italy$ETA>15,]
italy_final$W[italy_final$W == 0]=0.1
italy_final=italy_final[italy_final$W>0,]
italy_final=italy_final[italy_final$Y>0,]
#X <- italy[italy$Y > 0 & italy$W > 0,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
#Y <- italy[italy$Y > 0 & italy$W > 0,3]
X <- italy_final[,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
Y <- italy_final[,3]
data <- cbind(X,Y)
#data=data[data$Y != 0 & data$W != 0,]
data$Y=log(data$Y)
data$W=log(data$W)
which(is.na(x), arr.ind=TRUE)
sum(is.na(x))
#data=sample_n(data,300)
x = model.matrix(Y~., data=data)
y = data$Y
n = nrow(x) #10635
d = ncol(x) #57
nrow(x)
length(y)
#eliminate ANASC becuase we have age
#eliminate TIPOLAU_2 (scienze agrarie e veterinaria)
#eliminate Q
#eliminate SMARTW_2 which is for people who can not work remote
#eliminate TIPODIP_0 so istituto tecnico or no highschool is the base case
#eliminate SETT_1 so agricolture or no sector is the base case
model <- lm(Y~., data=data)
summary(model)
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
italy_final=italy[italy$ETA>15,]
italy_final$W[italy_final$W == 0]=0.1
italy_final=italy_final[italy_final$W>=0,]
italy_final=italy_final[italy_final$Y>0,]
#X <- italy[italy$Y > 0 & italy$W > 0,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
#Y <- italy[italy$Y > 0 & italy$W > 0,3]
X <- italy_final[,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
Y <- italy_final[,3]
data <- cbind(X,Y)
#data=data[data$Y != 0 & data$W != 0,]
data$Y=log(data$Y)
data$W=log(data$W)
which(is.na(x), arr.ind=TRUE)
sum(is.na(x))
#data=sample_n(data,300)
x = model.matrix(Y~., data=data)
y = data$Y
n = nrow(x) #10635
d = ncol(x) #57
nrow(x)
length(y)
#eliminate ANASC becuase we have age
#eliminate TIPOLAU_2 (scienze agrarie e veterinaria)
#eliminate Q
#eliminate SMARTW_2 which is for people who can not work remote
#eliminate TIPODIP_0 so istituto tecnico or no highschool is the base case
#eliminate SETT_1 so agricolture or no sector is the base case
model <- lm(Y~., data=data)
summary(model)
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
italy_final=italy[italy$ETA>15,]
italy_final$W[italy_final$W == 0]=0.1
italy_final=italy_final[italy_final$W>=0,]
italy_final=italy_final[italy_final$Y>0,]
#X <- italy[italy$Y > 0 & italy$W > 0,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
#Y <- italy[italy$Y > 0 & italy$W > 0,3]
X <- italy_final[,-c(1,2,3,4,5,16,17,38,39,51,50,59,60,64)]
Y <- italy_final[,3]
data <- cbind(X,Y)
#data=data[data$Y != 0 & data$W != 0,]
data$Y=log(data$Y)
data$W=log(data$W)
which(is.na(x), arr.ind=TRUE)
sum(is.na(x))
#data=sample_n(data,300)
x = model.matrix(Y~., data=data)
y = data$Y
n = nrow(x) #10635
d = ncol(x) #57
nrow(x)
length(y)
#eliminate ANASC becuase we have age
#eliminate TIPOLAU_2 (scienze agrarie e veterinaria)
#eliminate Q
#eliminate SMARTW_2 which is for people who can not work remote
#eliminate TIPODIP_0 so istituto tecnico or no highschool is the base case
#eliminate SETT_1 so agricolture or no sector is the base case
#eliminate OCNOW0
model <- lm(Y~., data=data)
summary(model)
quantr2=rq.fit.lasso(x, y,tau=0.1,na.rm=T)
library(quantreg)
quantr2=rq.fit.lasso(x, y,tau=0.1,na.rm=T)
quantr2=rq.fit.lasso(x, y,tau=0.1,na.rm=T)
quantr2=rq.fit.lasso(x, y,tau=0.1)
sum(quantr2$coefficients>0.00001)
quantr2$coefficients[quantr2$coefficients>0.00001]
quantr3=rq.fit.lasso(x, y,tau=0.9)
sum(quantr3$coefficients>0.00001)
quantr3$coefficients[quantr3$coefficients>0.00001]
fit.lassobic = lasso.bic(y,x[,-1])
fit.lassobic$lambda.opt
#0.003443198, 47 for W<0-->0.1
#0.0168346, 34 for Y,W<0-->0.1
#0.004692539, 46 for Y,W<0-->0
beta.lassobic = fit.lassobic$coef[-1]
length(names(beta.lassobic[which(beta.lassobic!=0)]))
beta.lassobic[which(beta.lassobic!=0)]
fit.lassobic$lambda.opt
library(quantreg)
quantr=rq(Y~., data=data,method="lasso",tau=0.1)
length(quantr$coefficients)
#summary.rq(rq(Y~., data=data,method="lasso"),se = "nid")
quantr2=rq.fit.lasso(x, y,tau=0.1,lambda = 0.004430518  )
sum(quantr2$coefficients>0.00001)
quantr2$coefficients[quantr2$coefficients>0.00001]
quantr3=rq.fit.lasso(x, y,tau=0.9,lambda = 0.004430518)
sum(quantr3$coefficients>0.00001)
quantr3$coefficients[quantr3$coefficients>0.00001]
sum(quantr2$coefficients>0.00001)
library(quantreg)
quantr=rq(Y~., data=data,method="lasso",tau=0.1)
length(quantr$coefficients)
#summary.rq(rq(Y~., data=data,method="lasso"),se = "nid")
quantr2=rq.fit.lasso(x, y,tau=0.1,lambda = 0.004430518  )
sum(quantr2$coefficients>0.00001)
quantr2$coefficients[quantr2$coefficients>0.00001]
quantr3=rq.fit.lasso(x, y,tau=0.9,lambda = 0.004430518)
sum(quantr3$coefficients>0.00001)
quantr3$coefficients[quantr3$coefficients>0.00001]
quantr2=rq.fit.lasso(x, y,tau=0.1,lambda = 0.004430518  )
sum(quantr2$coefficients>0.00001)
quantr2$coefficients[quantr2$coefficients>0.00001]
quantr3=rq.fit.lasso(x, y,tau=0.9,lambda = 0.004430518)
sum(quantr3$coefficients>0.00001)
quantr3$coefficients[quantr3$coefficients>0.00001]
print("poor")
quantr2=rq.fit.lasso(x, y,tau=0.1,lambda = 0.004430518  )
sum(quantr2$coefficients>0.00001)
quantr2$coefficients[quantr2$coefficients>0.00001]
quantr3=rq.fit.lasso(x, y,tau=0.9,lambda = 0.004430518)
sum(quantr3$coefficients>0.00001)
print("poor")
quantr2=rq.fit.lasso(x, y,tau=0.1,lambda = 0.004430518  )
sum(quantr2$coefficients>0.00001)
quantr2$coefficients[quantr2$coefficients>0.00001]
print("rich")
quantr3=rq.fit.lasso(x, y,tau=0.9,lambda = 0.004430518)
sum(quantr3$coefficients>0.00001)
quantr3$coefficients[quantr3$coefficients>0.00001]
fit.lassobic = lasso.bic(y,x[,-1])
fit.lassobic$lambda.opt
#0.003443198, 47 for W<0-->0.1
#0.0168346, 34 for Y,W<0-->0.1
#0.004692539, 46 for Y,W<0-->0
#0.004692539, 46 for Y<=00,w<0-->0
0.004430518 = fit.lassobic$coef[-1]
fit.lassobic = lasso.bic(y,x[,-1])
fit.lassobic$lambda.opt
#0.003443198, 47 for W<0-->0.1
#0.0168346, 34 for Y,W<0-->0.1
#0.004692539, 46 for Y,W<0-->0
#0.004692539, 46 for Y<=00,w<0-->0
#0.004430518 =
fit.lassobic$coef[-1]
length(names(beta.lassobic[which(beta.lassobic!=0)]))
beta.lassobic[which(beta.lassobic!=0)]
fit.lassobic = lasso.bic(y,x[,-1])
fit.lassobic$lambda.opt
#0.003443198, 47 for W<0-->0.1
#0.0168346, 34 for Y,W<0-->0.1
#0.004692539, 46 for Y,W<0-->0
#0.004692539, 46 for Y<=00,w<0-->0
#0.004430518 =
length(names(beta.lassobic[which(beta.lassobic!=0)]))
beta.lassobic[which(beta.lassobic!=0)]
fit.lassobic$coef[-1]
fit.lassobic = lasso.bic(y,x[,-1])
fit.lassobic$lambda.opt
#0.003443198, 47 for W<0-->0.1
#0.0168346, 34 for Y,W<0-->0.1
#0.004692539, 46 for Y,W<0-->0
#0.004692539, 46 for Y<=00,w<0-->0
#0.004430518 =
beta.lassobic=fit.lassobic$coef[-1]
length(names(beta.lassobic[which(beta.lassobic!=0)]))
beta.lassobic[which(beta.lassobic!=0)]
order(beta.lassobic[which(beta.lassobic!=0)])
beta.lassobic[which(beta.lassobic!=0)]
order(beta.lassobic[which(beta.lassobic!=0)])
order(beta.lassobic[which(beta.lassobic!=0)])
beta.lassobic[which(beta.lassobic!=0)]
fit.lassobic = lasso.bic(y,x[,-1])
fit.lassobic$lambda.opt
#0.003443198, 47 for W<0-->0.1
#0.0168346, 34 for Y,W<0-->0.1
#0.004692539, 46 for Y,W<0-->0
#0.004430518, 46 for Y<=0,w<0-->0
beta.lassobic=fit.lassobic$coef[-1]
length(names(beta.lassobic[which(beta.lassobic!=0)]))
beta.lassobic[which(beta.lassobic!=0)]
order(beta.lassobic[which(beta.lassobic!=0)])
lasso.cv = cv.glmnet(x=x[,-1], y=y, nfolds=10)
lasso.cv$lambda.min #10.94819
beta.lassocv=as.vector(coef(lasso.cv, s='lambda.min'))[-1]
beta.lassocv2=coef(lasso.cv, s='lambda.min')
length(rownames(beta.lassocv2)[-1][which(beta.lassocv!=0)])
rownames(beta.lassocv2)[-1][which(beta.lassocv!=0)]
beta.lassocv[which(beta.lassocv!=0)]
#PATH=getwd()
PATH="/Users/utente/desktop/famiglie/Data"
italy <- read_csv(file.path(PATH, "italy_income.csv"), col_names = T)
italy_final=italy[italy$ETA>15,]
italy_final$W[italy_final$W == 0]=0.1
italy_final=italy_final[italy_final$W>0,]
italy_final=italy_final[italy_final$Y>0,]
#X <- italy[italy$Y > 0 & italy$W > 0,-c(1,2,3,4,5,16,17,38,39,51,59,60,64)]
#Y <- italy[italy$Y > 0 & italy$W > 0,3]
X <- italy_final[,-c(1,2,3,4,5,16,17,38,39,51,50,59,60,64)]
Y <- italy_final[,3]
data <- cbind(X,Y)
#data=data[data$Y != 0 & data$W != 0,]
data$Y=log(data$Y)
data$W=log(data$W)
#which(is.na(x), arr.ind=TRUE)
#sum(is.na(x))
#data=sample_n(data,300)
x = model.matrix(Y~., data=data)
y = data$Y
n = nrow(x) #10635
d = ncol(x) #57
nrow(x)
length(y)
#eliminate ANASC becuase we have age
#eliminate TIPOLAU_2 (scienze agrarie e veterinaria)
#eliminate Q
#eliminate SMARTW_2 which is for people who can not work remote
#eliminate TIPODIP_0 so istituto tecnico or no highschool is the base case
#eliminate SETT_1 so agricolture or no sector is the base case
#eliminate OCNOW0
model <- lm(Y~., data=data)
summary(model)
print("poor")
quantr2=rq.fit.lasso(x, y,tau=0.1,lambda = 0.004430518  )
sum(quantr2$coefficients>0.00001)
quantr2$coefficients[quantr2$coefficients>0.00001]
print("rich")
quantr3=rq.fit.lasso(x, y,tau=0.9,lambda = 0.004430518)
sum(quantr3$coefficients>0.00001)
quantr3$coefficients[quantr3$coefficients>0.00001]
